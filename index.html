<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERSYS - Gestão de Diesel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>
    <style>
        .login-bg-image-new {
            background-image: url('https://ikypygpbdmoxozfmwewr.supabase.co/storage/v1/object/sign/Loginpage/unnamed%20(1).png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9lMGJiMDk5Zi1jZmE5LTQ5Y2UtYjUwNy0wZmE2ZWZkYWYxOTIiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJMb2dpbnBhZ2UvdW5uYW1lZCAoMSkucG5nIiwiaWF0IjoxNzU5MjYxNjYwLCJleHAiOjIwNzQ2MjE2NjB9.rulaTJo6deZqm5CNYCEfbKBf1K3HzljRLHRPoqAl_V8');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #e0e0e0; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #bdbdbd; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #a0a0a0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script type="text/javascript">
        // Definição dos ícones Lucide que usaremos
        const icons = {
            LayoutDashboard: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>',
            Ticket: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 9a3 3 0 0 1 0 6v1a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-1a3 3 0 0 1 0-6V8a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/></svg>',
            Fuel: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" x2="15" y1="22" y2="22"/><line x1="4" x2="14" y1="9" y2="9"/><path d="M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18"/><path d="M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-2v-4Z"/></svg>',
            Ship: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 21c.6.5 1.2 1 2.5 1 1.6 0 2.5-.5 5-1 2.5-.5 3.4 0 5 1 1.6.5 2.5 0 5-1 2.5-1 3-1.5 3-2 0 0 0-6.5-2-8l-2-2-2.5 1-1.5-2-3-2-3 2-1.5 2-2.5-1-2 2c-2 1.5-2 8-2 8Z"/><path d="M2 15h20"/><path d="M8 21V9l2-3 2 3v12"/><path d="m18 21-1-3-1 3h2Z"/></svg>',
            Beaker: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.5 3h15"/><path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-16V3"/><path d="M6 14h12"/></svg>',
            Users: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
            LogOut: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="17 16 22 12 17 8"/><line x1="22" x2="11" y1="12" y2="12"/></svg>',
            Menu: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>',
            ChevronUp: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-up"><path d="m18 15-6-6-6 6"/></svg>',
            ChevronDown: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><path d="m6 9 6 6 6-6"/></svg>',
            Trash2: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>',
            PlusCircle: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>',
            Building: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-building"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M12 18h.01"/></svg>',
            FileText: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L15 2z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>',
            Tank: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="16" x="2" y="6" rx="2"/><path d="M12 6V4"/><path d="M12 2v2"/><path d="M10 2h4"/><path d="m14 6-1 1-1-1"/><path d="m10 6-1 1-1-1"/><path d="M6 22h12"/><path d="M6 18h2"/><path d="M16 18h2"/></svg>',
            ChevronsLeft: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m11 17-5-5 5-5"/><path d="m18 17-5-5 5-5"/></svg>',
            CalendarDays: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>',
            Settings: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.78 1.28a2 2 0 0 0 .73 2.73l.04.02a2 2 0 0 1 .97 1.95v.44a2 2 0 0 1-.97 1.95l-.04.02a2 2 0 0 0-.73 2.73l.78 1.28a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.78-1.28a2 2 0 0 0-.73-2.73l-.04-.02a2 2 0 0 1-.97-1.95v-.44a2 2 0 0 1 .97-1.95l-.04-.02a2 2 0 0 0 .73-2.73l-.78-1.28a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>',
            ChevronsRight: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 17 5-5-5-5"/><path d="m13 17 5-5-5-5"/></svg>',
        };
        window.onload = function() {
            // ================================================================
            // 1. CONFIGURAÇÃO
            // ================================================================
            const SUPABASE_URL = 'https://ikypygpbdmoxozfmwewr.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlreXB5Z3BiZG1veG96Zm13ZXdyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxNTE0MTYsImV4cCI6MjA3NDcyNzQxNn0.IWoX896KWVC9p1M9EcFTOk6YhSljDOtxIl3yPxZS0Xg';
            let supabase;
            // ================================================================
            // 2. COMPONENTES AUXILIARES (Helpers)
            // ================================================================
            function LucideIcon({ name, className }) {
                return React.createElement('span', {
                    className: className,
                    dangerouslySetInnerHTML: { __html: icons[name] || '' }
                });
            }

            function Toast({ message, type, onClose }) {
                const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
                React.useEffect(() => {
                    const timer = setTimeout(() => onClose(), 3000);
                    return () => clearTimeout(timer);
                }, [onClose]);
                return React.createElement('div', { className: `fixed bottom-4 right-4 ${bgColor} text-white p-4 rounded-lg shadow-lg flex items-center z-50` }, message);
            }

            function DateRangePicker({ onDatesChange, placeholder }) {
                const inputRef = React.useRef(null);
                React.useEffect(() => {
                    if (!inputRef.current) return;

                    const fp = flatpickr(inputRef.current, {
                        mode: 'range',
                        dateFormat: "Y-m-d",
                        altInput: true,
                        altFormat: "d/m/Y",
                        locale: "pt",
                        onChange: (selectedDates) => {
                            if (selectedDates.length === 2) {
                                onDatesChange(selectedDates);
                            } else if (selectedDates.length === 0) {
                                onDatesChange([]);
                            }
                        },
                    });

                    return () => {
                        fp.destroy();
                    };
                }, [onDatesChange]);

                return React.createElement('div', { className: "relative w-full" },
                    React.createElement('div', { className: "absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none" },
                        React.createElement(LucideIcon, { name: "CalendarDays", className: "h-5 w-5 text-gray-400" })
                    ),
                    React.createElement('input', {
                        ref: inputRef,
                        type: 'text',
                        placeholder: placeholder || 'Selecione o período...',
                        className: 'w-full p-2 pl-10 border rounded'
                    })
                );
            }

            function ConfirmationModal({ message, onConfirm, onCancel }) {
                return React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50" },
                    React.createElement('div', { className: "bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center" },
                        React.createElement('p', { className: "text-lg font-semibold text-gray-800 mb-6" }, message),
                        React.createElement('div', { className: "flex justify-center space-x-4" },
                            React.createElement('button', { onClick: onConfirm, className: "px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition" }, "Confirmar"),
                            React.createElement('button', { onClick: onCancel, className: "px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition" }, "Cancelar")
                        )
                    )
                );
            }

            // ================================================================
            // 3. COMPONENTES DE PÁGINA (Módulos)
            // ================================================================
            
            function LoginPage({ onLogin }) {
                const [usuario, setUsuario] = React.useState('');
                const [senha, setSenha] = React.useState('');
                const [error, setError] = React.useState('');
                const [isLoggingIn, setIsLoggingIn] = React.useState(false);
                const handleLogin = async (e) => {
                    e.preventDefault();
                    setIsLoggingIn(true);
                    setError('');
                    try {
                        const { data, error: fetchError } = await supabase
                            .from('usuarios')
                            .select('*')
                            .eq('usuario', usuario.toLowerCase())
                            .eq('senha', senha)
                            .single();
                        
                        if (fetchError || !data) {
                            setError('Usuário ou senha inválidos.');
                        } else {
                            onLogin(data);
                        }
                    } catch (e) {
                        setError("Erro ao autenticar. Tente novamente.");
                    }
                    setIsLoggingIn(false);
                };
                return (
                    React.createElement('div', { className: "min-h-screen flex" },
                        React.createElement('div', { className: "w-full lg:w-1/2 flex items-center justify-center p-8 bg-white" },
                            React.createElement('div', { className: "max-w-md w-full" },
                                React.createElement('div', { className: "flex justify-center mb-6" },
                                    React.createElement('img', {
                                        src: "https://ikypygpbdmoxozfmwewr.supabase.co/storage/v1/object/sign/logo/LOGO_TERSYS-removebg-preview%20(1)%20(1).png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9lMGJiMDk5Zi1jZmE5LTQ5Y2UtYjUwNy0wZmE2ZWZkYWYxOTIiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJsb2dvL0xPR09fVEVSU1lTLXJlbW92ZWJnLXByZXZpZXcgKDEpICgxKS5wbmciLCJpYXQiOjE3NTkyMzU4NTYsImV4cCI6MjA3NDU5NTg1Nn0.R8XPKzBUjrjR3kcJijIvDaCGpGMlvyMKA6lsqiSOcEQ",
                                        alt: "TERSYS Logo",
                                        className: "h-auto w-auto"
                                    })
                                ),
                                error && React.createElement('div', { className: "bg-red-100 text-red-700 p-3 rounded text-center mb-4" }, error),
                                React.createElement('form', { onSubmit: handleLogin, className: "space-y-6" },
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "username", className: "block text-sm font-medium text-gray-700" }, "Usuário"),
                                        React.createElement('input', { type: "text", id: "username", value: usuario, onChange: (e) => setUsuario(e.target.value), className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500", placeholder: "Seu usuário", required: true, disabled: isLoggingIn })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { htmlFor: "password", className: "block text-sm font-medium text-gray-700" }, "Senha"),
                                        React.createElement('input', { type: "password", id: "password", value: senha, onChange: (e) => setSenha(e.target.value), className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500", placeholder: "Sua senha", required: true, disabled: isLoggingIn })
                                    ),
                                    React.createElement('button', { type: "submit", className: "w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50", disabled: isLoggingIn }, isLoggingIn ? 'Entrando...' : 'Entrar')
                                )
                            )
                        ),
                        React.createElement('div', { className: "hidden lg:block lg:w-1/2 login-bg-image-new" })
                    )
                );
            }
            
            /* INÍCIO DO NOVO COMPONENTE Alertas */

            function Alertas({ user, showToast }) {
                const [alertas, setAlertas] = React.useState([]);
                const [isLoading, setIsLoading] = React.useState(true);
                const [alertToConclude, setAlertToConclude] = React.useState(null);
                const [observacao, setObservacao] = React.useState('');
                const fetchAlertas = React.useCallback(async () => {
                    setIsLoading(true);
                    try {
                        const { data, error } = await supabase.from('alertas').select('*').order('data_criacao', { ascending: false });
                        if (error) throw error;
                        setAlertas(data || []);
                    } catch (err) {
                        showToast("Erro ao carregar alertas.", "error");
                    }
                    setIsLoading(false);
                }, [showToast]);

                React.useEffect(() => {
                    fetchAlertas();
                }, [fetchAlertas]);

                const handleConcluirClick = (alertaId) => {
                    setAlertToConclude(alertaId);
                    setObservacao('');
                };

                const handleCancelConclusao = () => {
                    setAlertToConclude(null);
                    setObservacao('');
                };

                const handleConfirmConclusao = async () => {
                    if (!alertToConclude) return;
                    setIsLoading(true);
                    try {
                        const { error } = await supabase
                            .from('alertas')
                            .update({
                                status: 'concluido',
                                observacao: observacao.trim(),
                                usuario_conclusao: user.nome,
                                data_conclusao: new Date().toISOString()
                            })
                            .eq('id', alertToConclude);
                        if (error) throw error;
                        showToast("Alerta concluído com sucesso!", "success");
                        setAlertToConclude(null);
                        fetchAlertas();
                    } catch (err) {
                        showToast(`Erro ao concluir alerta: ${err.message}`, "error");
                    }
                    setIsLoading(false);
                };

                const alertasPendentes = alertas.filter(a => a.status === 'pendente');
                const alertasConcluidos = alertas.filter(a => a.status === 'concluido');

                const AlertCard = ({ alerta }) => (
                    React.createElement('div', { className: "bg-white p-4 rounded-lg shadow-md border-l-4 border-yellow-500" },
                        React.createElement('p', { className: "text-sm text-gray-500" }, `Período: ${alerta.periodo || 'N/A'}`),
                        React.createElement('p', { className: "text-lg font-bold text-gray-800" }, `Placa: ${alerta.placa || 'N/A'}`),
                        React.createElement('p', { className: "text-sm text-gray-600 mt-1" }, `Alerta: ${alerta.tipo_alerta}`),
                        
                        alertToConclude === alerta.id
                            ? React.createElement('div', { className: 'mt-4' },
                                React.createElement('textarea', {
                                    value: observacao,
                                    onChange: (e) => setObservacao(e.target.value),
                                    placeholder: 'Adicionar observação (opcional)...',
                                    className: 'w-full p-2 border rounded text-sm'
                                }),
                                React.createElement('div', { className: 'flex justify-end gap-2 mt-2' },
                                    React.createElement('button', { onClick: handleCancelConclusao, className: 'text-sm text-gray-600' }, 'Cancelar'),
                                    React.createElement('button', { onClick: handleConfirmConclusao, className: 'text-sm text-green-600 font-semibold' }, 'Confirmar')
                                )
                              )
                            : React.createElement('button', {
                                onClick: () => handleConcluirClick(alerta.id),
                                className: "mt-4 text-sm font-semibold text-blue-600 hover:text-blue-800"
                                }, 'Concluir')
                    )
                );

                const CompletedAlertCard = ({ alerta }) => (
                     React.createElement('div', { className: "bg-white p-4 rounded-lg shadow-sm border-l-4 border-green-500 opacity-70" },
                        React.createElement('p', { className: "text-sm text-gray-500" }, `Período: ${alerta.periodo || 'N/A'}`),
                        React.createElement('p', { className: "text-lg font-bold text-gray-800" }, `Placa: ${alerta.placa || 'N/A'}`),
                        React.createElement('p', { className: "text-sm text-gray-600 mt-1" }, `Alerta: ${alerta.tipo_alerta}`),
                        React.createElement('div', { className: 'mt-2 text-xs text-gray-500' },
                             React.createElement('p', null, `Concluído por: ${alerta.usuario_conclusao} em ${new Date(alerta.data_conclusao).toLocaleDateString('pt-BR')}`),
                             alerta.observacao && React.createElement('p', { className: 'italic' }, `Obs: "${alerta.observacao}"`)
                        )
                    )
                );

                return React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                    React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-6 text-center" }, "Painel de Alertas"),

                    React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-8" },
                        // Coluna de Pendentes
                        React.createElement('div', null,
                            React.createElement('h3', { className: 'text-lg font-semibold mb-4 text-yellow-600' }, `Pendentes (${alertasPendentes.length})`),
                            isLoading && alertasPendentes.length === 0 ? React.createElement('p', null, 'Carregando...') :
                            alertasPendentes.length === 0 ? React.createElement('p', { className: 'text-sm text-gray-500' }, 'Nenhuma tarefa pendente.') :
                            React.createElement('div', { className: 'space-y-4' }, alertasPendentes.map(alerta => React.createElement(AlertCard, { key: alerta.id, alerta: alerta })))
                        ),
                        // Coluna de Concluídos
                        React.createElement('div', null,
                            React.createElement('h3', { className: 'text-lg font-semibold mb-4 text-green-600' }, `Concluídas (${alertasConcluidos.length})`),
                             isLoading && alertasConcluidos.length === 0 ? React.createElement('p', null, 'Carregando...') :
                            alertasConcluidos.length === 0 ? React.createElement('p', { className: 'text-sm text-gray-500' }, 'Nenhuma tarefa concluída.') :
                            React.createElement('div', { className: 'space-y-4' }, alertasConcluidos.map(alerta => React.createElement(CompletedAlertCard, { key: alerta.id, alerta: alerta })))
                        )
                    )
                );
            }
            
            /* FIM DO NOVO COMPONENTE */

            function Dashboard({ user, showToast }) {
                return React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                    React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4" }, `Olá, ${user.nome}!`),
                    React.createElement('p', null, "Dashboard com os últimos abastecimentos de cada origem (em desenvolvimento).")
                );
            }
            
            // ... (restante dos seus componentes de página existentes) ...

            // ================================================================
            // 4. COMPONENTE PRINCIPAL (App)
            // ================================================================
            function App() {
                const [user, setUser] = React.useState(() => {
                    const savedUser = localStorage.getItem('userSession');
                    return savedUser ? JSON.parse(savedUser) : null;
                });
                const [currentPage, setCurrentPage] = React.useState('dashboard');
                const [toast, setToast] = React.useState({ show: false, message: '', type: '' });
                const [isSidebarOpen, setIsSidebarOpen] = React.useState(false);
                const [openMenu, setOpenMenu] = React.useState('');
                const [isSidebarCollapsed, setIsSidebarCollapsed] = React.useState(false);
                const handleLogin = (userData) => {
                    localStorage.setItem('userSession', JSON.stringify(userData));
                    setUser(userData);
                    setCurrentPage('dashboard');
                };
                const handleLogout = () => {
                    localStorage.removeItem('userSession');
                    setUser(null);
                };
                const showToast = (message, type = 'success') => setToast({ show: true, message, type });
                const closeToast = () => setToast({ show: false, message: '', type: '' });
                
                const toggleMenu = (menu) => {
                    if (isSidebarCollapsed) {
                        setIsSidebarCollapsed(false);
                    } else {
                        setOpenMenu(openMenu === menu ? '' : menu);
                    }
                };

                const toggleSidebarCollapse = () => {
                    setIsSidebarCollapsed(!isSidebarCollapsed);
                    if (!isSidebarCollapsed) {
                        setOpenMenu('');
                    }
                };
                
                const renderPage = () => {
                    switch (currentPage) {
                        case 'dashboard': return React.createElement(Dashboard, { user, showToast });
                        case 'ticketAbastecimentos': return React.createElement(TicketAbastecimentos, { user, showToast });
                        case 'ctaAbastecimentos': return React.createElement(CtaAbastecimentos, { user, showToast });
                        case 'ctaCarregamentos': return React.createElement(CtaCarregamentos, { user, showToast });
                        case 'shellAbastecimentos': return React.createElement(ShellAbastecimentos, { user, showToast });
                        case 'afericoes': return React.createElement(Afericoes, { user, showToast });
                        case 'alertas': return React.createElement(Alertas, { user, showToast });
                        case 'cadastroFiliais': return user.nivel_permissao === 'administrador' ? React.createElement(CadastroFiliais, { user, showToast }) : null;
                        case 'mapeamentoCombustivel': return user.nivel_permissao === 'administrador' ? React.createElement(MapeamentoCombustivel, { user, showToast }) : null;
                        case 'userManagement': return React.createElement(UserManagement, { user, showToast });
                        default: return React.createElement(Dashboard, { user, showToast });
                    }
                };
                
                if (!user) {
                    return React.createElement(LoginPage, { onLogin: handleLogin });
                }

                const MenuItem = ({ page, icon, text }) => {
                   const isActive = currentPage === page;
                   return React.createElement('li', null,
                       React.createElement('button', {
                           onClick: () => { setCurrentPage(page); setIsSidebarOpen(false); },
                           className: `flex items-center w-full px-4 py-2 rounded-lg transition-colors ${isSidebarCollapsed ? 'justify-center' : ''} ${isActive ? 'bg-blue-600 text-white' : 'hover:bg-gray-700 text-gray-300'}`
                       },
                           React.createElement(LucideIcon, { name: icon, className: `h-5 w-5 flex-shrink-0 ${!isSidebarCollapsed && 'mr-3'}` }),
                           !isSidebarCollapsed && React.createElement('span', {className: 'truncate'}, text)
                       )
                    );
                };
                
                const MenuCategory = ({ title, icon, children, menuKey }) => {
                    const isOpen = openMenu === menuKey;
                    return (
                        React.createElement('li', { className: "mb-2" },
                            React.createElement('button', {
                                onClick: () => toggleMenu(menuKey),
                                className: `flex items-center w-full px-4 py-2 rounded-lg transition-colors ${isSidebarCollapsed ? 'justify-center' : ''} ${!isSidebarCollapsed ? 'justify-between' : ''} ${isOpen && !isSidebarCollapsed ? 'bg-gray-700' : 'hover:bg-gray-700'} text-gray-200`
                            },
                                React.createElement('span', {className: 'flex items-center truncate'},
                                    React.createElement(LucideIcon, { name: icon, className: `h-5 w-5 flex-shrink-0 ${!isSidebarCollapsed && 'mr-3'}` }),
                                    !isSidebarCollapsed && React.createElement('span', {className: 'truncate'}, title)
                                ),
                                !isSidebarCollapsed && React.createElement(LucideIcon, { name: isOpen ? "ChevronUp" : "ChevronDown", className: "h-5 w-5 flex-shrink-0" })
                            ),
                            !isSidebarCollapsed && isOpen && React.createElement('ul', { className: "ml-4 mt-2 space-y-2 border-l border-gray-700 pl-4" }, children)
                        )
                    );
                };

                return (
                    React.createElement('div', { className: "flex min-h-screen bg-gray-100" },
                        React.createElement('aside', { className: `fixed inset-y-0 left-0 bg-gray-800 text-white p-4 transform ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 transition-all duration-300 z-30 flex flex-col ${isSidebarCollapsed ? 'w-24' : 'w-72'}` },
                            React.createElement('div', { className: "flex items-center justify-center mb-8" },
                                React.createElement('img', { 
                                    src: "https://ikypygpbdmoxozfmwewr.supabase.co/storage/v1/object/sign/logo/LOGO_TERSYS-removebg-preview%20(1)%20(1).png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9lMGJiMDk5Zi1jZmE5LTQ5Y2UtYjUwNy0wZmE2ZWZkYWYxOTIiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJsb2dvL0xPR09fVEVSU1lTLXJlbW92ZWJnLXByZXZpZXcgKDEpICgxKS5wbmciLCJpYXQiOjE3NTkyMzU4NTYsImV4cCI6MjA3NDU5NTg1Nn0.R8XPKzBUjrjR3kcJijIvDaCGpGMlvyMKA6lsqiSOcEQ", 
                                    alt: "Logo", 
                                    className: `cursor-pointer transition-all duration-300 ${isSidebarCollapsed ? 'h-12 w-auto' : 'h-16 w-auto'}`,
                                    onClick: () => setCurrentPage('dashboard') 
                                })
                            ),
                            
                            React.createElement('nav', { className: "flex-grow" },
                                React.createElement('ul', { className: "space-y-2" },
                                    React.createElement(MenuItem, { page: 'dashboard', icon: 'LayoutDashboard', text: 'Dashboard' }),
                                    
                                    React.createElement(MenuCategory, { title: "Importação", icon: "PlusCircle", menuKey: "importacao" },
                                        React.createElement(MenuItem, { page: 'ticketAbastecimentos', icon: 'Ticket', text: 'Ticket Abastecimentos' }),
                                        React.createElement(MenuItem, { page: 'ctaAbastecimentos', icon: 'Fuel', text: 'CTA Abastecimentos' }),
                                        React.createElement(MenuItem, { page: 'ctaCarregamentos', icon: 'Ship', text: 'CTA Carregamentos' }),
                                        React.createElement(MenuItem, { page: 'shellAbastecimentos', icon: 'Fuel', text: 'Shell Abastecimentos' })
                                    ),
                                    
                                    React.createElement(MenuCategory, { title: "Operacional", icon: "Settings", menuKey: "operacional" },
                                        React.createElement(MenuItem, { page: 'alertas', icon: 'FileText', text: 'Alertas' }),
                                        React.createElement(MenuItem, { page: 'afericoes', icon: 'Tank', text: 'Aferições' }),
                                    ),
                                    
                                    user.nivel_permissao === 'administrador' && React.createElement(MenuCategory, { title: "Cadastros", icon: "FileText", menuKey: "cadastros" },
                                        React.createElement(MenuItem, { page: 'cadastroFiliais', icon: 'Building', text: 'Filiais (DE/PARA)' }),
                                        React.createElement(MenuItem, { page: 'mapeamentoCombustivel', icon: 'Fuel', text: 'DE/PARA Combustível' }),
                                        React.createElement(MenuItem, { page: 'userManagement', icon: 'Users', text: 'Usuários' })
                                    )
                                )
                            ),

                            React.createElement('div', {className: 'mt-auto pt-4 border-t border-gray-700'},
                                React.createElement('button', { 
                                    onClick: toggleSidebarCollapse,
                                    className: "w-full flex items-center p-3 rounded-lg text-gray-400 hover:bg-gray-700 justify-center mb-2" 
                                },
                                    React.createElement(LucideIcon, { name: isSidebarCollapsed ? "ChevronsRight" : "ChevronsLeft", className: "w-6 h-6" })
                                ),
                                React.createElement('button', { 
                                    onClick: handleLogout, 
                                    className: `w-full flex items-center p-3 rounded-lg text-red-400 hover:bg-gray-700 ${isSidebarCollapsed ? 'justify-center' : ''}`
                                },
                                    React.createElement(LucideIcon, { name: "LogOut", className: `w-6 h-6 ${!isSidebarCollapsed && 'mr-3'}` }),
                                    !isSidebarCollapsed && 'Sair'
                                )
                            )
                        ),
                        
                        React.createElement('main', { className: "flex-1 p-4 md:p-8 flex flex-col" },
                            React.createElement('header', { className: "w-full bg-white p-4 rounded-xl shadow-lg mb-8 flex justify-between items-center" },
                                React.createElement('button', { className: "md:hidden text-gray-700 p-2", onClick: () => setIsSidebarOpen(true) }, React.createElement(LucideIcon, { name: "Menu" })),
                                React.createElement('div', { className: "text-right text-sm text-gray-600" },
                                    React.createElement('p', null, "Usuário: ", React.createElement('strong', null, user.nome)),
                                    React.createElement('p', {className: "capitalize"}, "Permissão: ", React.createElement('strong', null, user.nivel_permissao))
                                )
                            ),
                            React.createElement('div', { className: "flex-grow" }, renderPage()),
                            toast.show && React.createElement(Toast, { message: toast.message, type: toast.type, onClose: closeToast })
                        )
                    )
                );
            }

            // ================================================================
            // 5. INICIALIZAÇÃO
            // ================================================================
            const initializeSupabaseAndRenderApp = () => {
                try {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    ReactDOM.render(React.createElement(App), document.getElementById('root'));
                } catch (e) {
                    console.error("Erro ao inicializar o cliente Supabase:", e);
                }
            };

            const supabaseScript = document.createElement('script');
            supabaseScript.src = "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.0/dist/umd/supabase.min.js";
            supabaseScript.onload = initializeSupabaseAndRenderApp;
            document.head.appendChild(supabaseScript);
        }
    </script>
</body>
</html>
